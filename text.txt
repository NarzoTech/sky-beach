
## 1ï¸âƒ£ Core Philosophy (Very Important)

Restaurants **do NOT manage stock by menu items**.
They manage stock by **ingredients**.

ğŸ‘‰ Menu items only **consume ingredients**
ğŸ‘‰ Purchases only **increase ingredient stock**
ğŸ‘‰ Sales only **reduce ingredient stock (via recipe)**

Everything else is just math.

---

## 2ï¸âƒ£ Master Tables (Foundation)

### 2.1 Unit Types (Normalization Layer)

You must support **conversion**, or your stock will break.

**unit_types**

* id
* name â†’ kg, gm, liter, ml, pcs
* base_unit_id (nullable)
* conversion_rate

  * 1 kg = 1000 gm
  * 1 liter = 1000 ml

ğŸ“Œ **Rule**:
Each ingredient has **ONE base unit** (gm / ml / pcs)

---

### 2.2 Ingredient Categories

For filtering, reporting, and future scalability.

**ingredient_categories**

* id
* name

  * Vegetables
  * Meat
  * Spices
  * Dairy

---

### 2.3 Ingredients (The Heart of Inventory)

**ingredients**

* id
* ingredient_category_id
* name (Chicken Breast, Onion, Olive Oil)
* base_unit_id (gm / ml / pcs)
* current_stock (stored in base unit)
* average_cost_per_unit (important for P&L)
* alert_stock_level
* is_active

ğŸ“Œ **Store stock ONLY in base unit**
Never mix kg + gm in stock.

---

## 3ï¸âƒ£ Menu Structure (Sales Layer)

### 3.1 Menu Categories

**menu_categories**

* id
* name

  * Starters
  * Main Course
  * Drinks

---

### 3.2 Menu Items

**menu_items**

* id
* menu_category_id
* name
* selling_price
* is_active

Menu items **do not have stock**.

---

## 4ï¸âƒ£ Recipe Management (Critical Logic)

### 4.1 Menu Item Recipes (BOM â€“ Bill of Materials)

**menu_item_ingredients**

* id
* menu_item_id
* ingredient_id
* quantity (in base unit)
* unit_id (for UI only)

Example:
ğŸ— **Chicken Burger**

* Chicken Breast â†’ 150 gm
* Bun â†’ 1 pcs
* Oil â†’ 10 ml

ğŸ“Œ During save:

* Convert everything â†’ base unit
* Store quantity in base unit

---

## 5ï¸âƒ£ Purchase Flow (Stock IN)

### 5.1 Purchases

**purchases**

* id
* supplier_id
* purchase_date
* total_amount

**purchase_items**

* purchase_id
* ingredient_id
* quantity
* unit_id
* unit_price
* total_price

### 5.2 Stock Update Logic (VERY IMPORTANT)

When purchase is approved:

1. Convert quantity â†’ base unit
2. Increase ingredient stock
3. Recalculate **weighted average cost**

#### Average Cost Formula:

```
new_avg_cost =
((old_stock Ã— old_avg_cost) + purchase_total) /
(new_total_stock)
```

ğŸ“Œ This gives accurate profit calculation later.

---

## 6ï¸âƒ£ Sales Flow (Stock OUT)

### 6.1 Orders

**orders**

* id
* order_date
* total_amount
* payment_method

**order_items**

* order_id
* menu_item_id
* quantity
* selling_price

---

### 6.2 Ingredient Deduction Logic

For each menu item sold:

1. Get recipe
2. Multiply ingredient qty Ã— order qty
3. Reduce ingredient stock

Example:
Sold **2 Chicken Burgers**

* Chicken â†’ 150 Ã— 2 = 300 gm
* Bun â†’ 2 pcs
* Oil â†’ 20 ml

ğŸ“Œ If stock < required â†’ **block sale or warn**

---

## 7ï¸âƒ£ Stock Movement Log (Non-negotiable)

Never directly trust `current_stock`.

**ingredient_stock_movements**

* id
* ingredient_id
* type

  * PURCHASE
  * SALE
  * ADJUSTMENT
  * WASTAGE
* reference_id
* qty_in
* qty_out
* balance_after
* unit_cost
* created_at

ğŸ“Œ This table lets you:

* Audit
* Debug
* Generate reports
* Recalculate stock anytime

---

## 8ï¸âƒ£ Wastage & Adjustment

### 8.1 Wastage

Expired, damaged, overcooked food.

**wastages**

* ingredient_id
* quantity
* reason

â¡ Deduct stock
â¡ Add cost to expense

---

### 8.2 Manual Adjustment

For real-world mismatch.

**stock_adjustments**

* ingredient_id
* before_qty
* after_qty
* reason

---

## 9ï¸âƒ£ Profit & Loss Calculation (This Is Gold ğŸ’°)

### 9.1 Cost of Goods Sold (COGS)

For each order item:

```
ingredient_cost =
Î£ (ingredient_used Ã— avg_cost_per_unit)
```

Example:

* Chicken â†’ 300 gm Ã— 0.05 = 15
* Bun â†’ 2 Ã— 10 = 20
* Oil â†’ 20 ml Ã— 0.02 = 0.4

COGS = **35.4**

---

### 9.2 Order Profit

```
profit = selling_price - COGS
```

---

### 9.3 Daily / Monthly P&L

**Revenue**

* Sum of order totals

**Expenses**

* Ingredient purchases
* Wastage cost
* Staff salary
* Rent
* Utilities

**Net Profit**

```
Revenue - (COGS + Expenses)
```

---

## ğŸ”Ÿ Reports You MUST Provide

* Ingredient Stock Report
* Low Stock Alert
* Daily Sales
* Menu Item Profitability
* Ingredient Consumption Report
* Purchase vs Usage Report
* Wastage Report
* Profit & Loss Statement

---

## 11ï¸âƒ£ Real-World Edge Cases (Experience Talk ğŸ˜)

âœ” Same ingredient used in multiple menus
âœ” Partial unit usage (0.5 pcs cheese)
âœ” Menu price change doesnâ€™t affect past profit
âœ” Ingredient price fluctuation handled via avg cost
âœ” Disable menu item automatically if ingredient out of stock
